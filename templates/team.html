<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>{{ team.get('name', 'Team') }} - Team Page</title>
  <style>
    body { background-color:#2f2f2f; color:#eee; font-family:Arial, sans-serif; padding:20px; }
    .flash { color:#4CAF50; margin-bottom:10px; }
    input[type="text"], input[type="date"], input[type="number"] { padding:5px; margin:3px 0; border:1px solid #555; border-radius:3px; background:#444; color:#eee; width:80px; }
    button { padding:5px 10px; background:#666; color:#eee; border:none; border-radius:3px; cursor:pointer; margin-left:5px; }
    .player-list a { display:block; margin:2px 0; color:#80dfff; text-decoration:none; }
    table { border-collapse: collapse; margin-top:10px; }
    th, td { padding:5px 10px; border:1px solid #555; text-align:center; }
    form.inline { display:inline; margin:0; }
  </style>
</head>
<body>
  <h2>{{ team.get('name', 'Team') }} - Team Page</h2>

  {% with messages = get_flashed_messages() %}
    {% if messages %}
      {% for message in messages %}
        <div class="flash">{{ message }}</div>
      {% endfor %}
    {% endif %}
  {% endwith %}

  <h3>Players</h3>
  <div class="player-list">
    {% for player in team.get('players', []) %}
      <a href="{{ url_for('player_page', team_name=team.get('name','Team')|replace(' ','_'), player_name=player.get('name','')|replace(' ','_')) }}">{{ player.get('name','') }}</a>
    {% endfor %}
  </div>

  <h3>Team Stats</h3>
  <table>
    <tr>
      <th>Stat</th>
      <th>Value</th>
      <th>Update</th>
    </tr>
    {% for stat in ['played','wins','draws','losses'] %}
      {% set stat_value = team.get(stat,0) %}
      <tr>
        <td>{{ stat.capitalize() }}</td>
        <td>{{ stat_value }}</td>
        <td>
          <!-- Increment -->
          <form method="POST" class="inline">
            <input type="hidden" name="request_type" value="update_stat">
            <input type="hidden" name="stat" value="{{ stat }}">
            <input type="hidden" name="increment" value="1">
            <input type="text" name="user_name" placeholder="Enter Your Name" required>
            <button type="submit">⬆</button>
          </form>
          <!-- Decrement -->
          {% if stat_value > 0 %}
          <form method="POST" class="inline">
            <input type="hidden" name="request_type" value="update_stat">
            <input type="hidden" name="stat" value="{{ stat }}">
            <input type="hidden" name="increment" value="-1">
            <input type="text" name="user_name" placeholder="Enter Your Name" required>
            <button type="submit">⬇</button>
          </form>
          {% endif %}
        </td>
      </tr>
    {% endfor %}
    <tr>
      <td>Points</td>
      <td>{{ team.get('points',0) }}</td>
      <td>-</td>
    </tr>
  </table>

  <h3>Current Lineup</h3>
  <div>
    {% for player in team.get('lineup', []) %}
      <p>{{ player }}</p>
    {% endfor %}
  </div>

  <h3>Request Lineup Update</h3>
  {% set lineup = team.get('lineup', []) %}
  <form method="POST">
    <input type="hidden" name="request_type" value="lineup">
    <label>Your Name:</label>
    <input type="text" name="user_name" placeholder="Enter Your Name" required><br><br>
    {% for i in range(8) %}
      <input type="text" name="lineup" value="{{ lineup[i] if i < lineup|length else '' }}" placeholder="Player {{ i+1 }}"><br>
    {% endfor %}
    <label>Date:</label>
    <input type="date" name="lineup_date" required><br><br>
    <button type="submit">Send Request</button>
  </form>

  {% if team.get('confirmed_lineups') %}
    <h3>Confirmed Lineups</h3>
    {% for cl in team.get('confirmed_lineups', []) %}
      <p><strong>Date:</strong> {{ cl.get('date','') }}</p>
      <p><strong>Lineup:</strong>
        {% for player in cl.get('lineup',[]) %}
          <a href="{{ url_for('player_page', team_name=team.get('name','Team')|replace(' ','_'), player_name=player|replace(' ','_')) }}">{{ player }}</a>{% if not loop.last %}, {% endif %}
        {% endfor %}
      </p>
      <form method="POST">
        <input type="hidden" name="request_type" value="delete_lineup">
        <input type="hidden" name="lineup_date" value="{{ cl.get('date','') }}">
        <input type="text" name="user_name" placeholder="Enter Your Name" required>
        <button type="submit">Request Delete</button>
      </form>
    {% endfor %}
  {% endif %}

  <p><a href="{{ url_for('league_table') }}">⬅ Back to League Table</a></p>
</body>
</html>
